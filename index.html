<!DOCTYPE html>
<meta charset="UTF-8">
<title>IHS Inflation Data Visualization Tool</title>
<link href="lib/css/nv.d3.css" rel="stylesheet" type="text/css">
<link href="lib/css/teststyle.css" rel="stylesheet" type='text/css'>

<style type="text/css">
div.inline { float:left; }
div.inlinel { float:right; }
.clearBoth { clear:both; }

button.btn {
  -webkit-border-radius: 28;
  -moz-border-radius: 28;
  border-radius: 28px;
  font-family: Arial;
  color: #8a828a;
  font-size: 15px;
  background: #bfbfbf;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
  cursor: pointer; cursor: hand;
  width:16%;
  height: 80px;
}

#save{
  -webkit-border-radius: 28;
  -moz-border-radius: 28;
  border-radius: 28px;
  font-family: Arial;
  color: #8a828a;
  font-size: 15px;
  background: #bfbfbf;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
  cursor: pointer; cursor: hand;
}

button.btn:hover {
  background: #86bee0;
  text-decoration: none;
}
#save:hover{
  background: #edfa3c;
  text-decoration: none;
}

button.clicked{
  background: #86bee0;
  text-decoration: none;
}

</style>
<head>
</head>
<body>
<div class="de" align="center">
<button id="CP00" class="btn DE" title="Inflationsrate (HVPI)">Inflationsrate (HVPI)</button>
<button id="DIFFREAL" class="btn DE" title="Inflationsraten (HVPI) im L&#228;ndervergleich">Inflationsraten - L&#228;ndervergleich</button>
<button id="NATURAL" class="btn DE" title="Beitr&#228;ge zur Inflation (4 Hauptaggregate)">Beitr&#228;ge - 4 Hauptaggregate</button>
<button id="AP_ALL" class="btn DE" title="Beitr&#228;ge zur Inflation (12 Subaggregate)">Beitr&#228;ge - 12 Subaggregate</button>
<button id="CP" class="btn DE" title="Beitr&#228;ge zur Inflation (12 COICOP-Hauptgruppen)">Beitr&#228;ge - 12 Hauptgruppen</button>
<button id="DIFF" class="btn DE" title="Beitr&#228;ge zur Inflation im L&#228;ndervergleich (4 Hauptaggregate)">Beitr&#228;ge im L&#228;ndervergleich - 4 Hauptaggregate</button>
</div>

<div class="en" align="center">
<button id="CP00" class="btn EN" title="Inflation rate (HVPI)">Inflation rate</button>
<button id="DIFFREAL" class="btn EN" title="Inflation Rate (HVPI) Comparisons">Inflation Comparisons</button>
<button id="NATURAL" class="btn EN" title="Factors Contributing to Inflation (4 Main Aggregates)">Contributors - 4 Main Aggregates</button>
<button id="AP_ALL" class="btn EN" title="Factors Contributing to Inflation (12 Subaggregates)">Contributors - 12 Subaggregates</button>
<button id="CP" class="btn EN" title="Factors Contributing to Inflation (12 Main Groups)">Contributors - 12 Main Groups</button>
<button id="DIFF" class="btn EN" title="Comparison of factors Contributing to Inflation (4 Main Aggregates)">Contributors Comparison - 4 Main Aggregates</button>
</div>

 <p class="de" id=languageSelection><b>Sprache ausw&#228;hlen:</b></p>
  <p class="en" id=languageSelection><b>Change Language</b></p>
<select id="LanguageSelection">
  <option value="EN">English</option>
  <option selected value="DE">Deutsch</option>
</select>
<p><p><p><p>


  <div class='chart full' id='chart1'><div style="font-size:22px" id="cateLabel"> </div> <p style="font-size:5px"> &nbsp</p> <div id="countryLabel"> </div><svg id="diagram"></svg></div>

<div>&nbsp</div>
<div>&nbsp</div>
<div align="center"><button id="save">Save as PNG</button></div>
<div>&nbsp</div>
<div>&nbsp</div>

<script src="lib/js/d3.v3.js"></script>
<script src="lib/js/nv.d3.js"></script>
<script src="lib/js/src/utils.js"></script>
<script src="lib/js/src/models/axis.js"></script>
<script src="lib/js/src/tooltip.js"></script>
<script src="lib/js/src/interactiveLayer.js"></script>
<script src="lib/js/src/models/legend.js"></script>
<script src="lib/js/src/models/axis.js"></script>
<script src="lib/js/src/models/scatter.js"></script>
<script src="lib/js/src/models/stackedArea.js"></script>
<script src="lib/js/src/models/stackedAreaChart.js"></script>
<script src="lib/js/src/models/lineChart.js"></script>
<script src="lib/js/testScript.js"></script>
<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="lib/js/jquery.cookie.js"></script>
<script src="https://raw.githubusercontent.com/exupero/saveSvgAsPng/gh-pages/saveSvgAsPng.js"></script>
<div class="inline">

<!--p class="de" id="category selection"><b>Analyse ausw&#228;hlen:</b></p>
<p class="en" id="category selection"><b>Choose an Analysis</b></p>
<select class="de" id="CategorySelection">
  <option value="CP00">Inflationsrate (HVPI)</div></option>
  <option value="DIFFREAL">Inflationsraten (HVPI) im L&#228;ndervergleich </option>
  <option selected value="NATURAL">Beitr&#228;ge zur Inflation (4 Hauptaggregate)</option>
  <option selected value="AP_ALL">Beitr&#228;ge zur Inflation (12 Subaggregate)</option>
  <option value="CP">Beitr&#228;ge zur Inflation (12 COICOP-Hauptgruppen)</option>
  <option value="DIFF">Beitr&#228;ge zur Inflation im L&#228;ndervergleich (4 Hauptaggregate)</option>
</select>

<select class="en" id="CategorySelection">
  <option value="CP00">Inflation rate (HVPI)</div></option>
   <option value="DIFFREAL">Inflation Rate (HVPI) Comparisons </option>
  <option selected value="NATURAL">Factors Contributing to Inflation (4 Main Aggregates)</option>
  <option selected value="AP_ALL">Factors Contributing to Inflation (12 Subaggregates)</option>
  <option value="CP">Factors Contributing to Inflation (12 Main Groups)</option>
  <option value="DIFF">Comparison of factors Contributing to Inflation (4 Main Aggregates)</option>
</select-->

<p class="SubCategory de"><b>Aggregat/Gruppe ausw&#228;hlen:</b></p>
<p class="SubCategory en"><b>Choose Aggregate/Group</b></p>
<select class="SubCategory de" id="SubCategorySelection">
  
  <option value="CP00"> &nbsp; CP00 - Gesamt-HVPI </option>
  <option value="Group" disabled>[4 Hauptaggregate]</option>
  <option value="NRG"> &nbsp; E -Energie</option>
  <option value="FOOD"> &nbsp; F -Lebensmittel einschlie&szlig;lich Alkohol und Tabak</option>
  <option value="IGD_NNRG"> &nbsp; G - Industrielle nichtenergetische GÃ¼ter</option>
  <option value="SERV"> &nbsp; S - Dienstleistungen</option>
  
  <option value="Group" disabled>[12 Subaggregate]</option>
  <option value="ELC_GAS"> &nbsp; E1 - Elektrizit&#228;t, Gas, feste Brennstoffe und W&#228;rmeenergie </option>
  <option value="FUEL"> &nbsp; E2 - Fl&#252;ssige Brennstoffe, Kraft- und Schmierstoffe f&#252;r private Verkehrsmittel</option> 
  <option value="FOOD_P"> &nbsp; F1 - Bearbeitete Lebensmittel einschlie&szlig;lich Alkohol und Tabak </option>
  <option value="FOOD_NP"> &nbsp; F2 - Unbearbeitete Lebensmittel</option>
  <option value="IGD_NNRG_D"> &nbsp; G1 - Industrielle nichtenergetische G&#252;ter, nur Gebrauchsg&#252;ter </option>
  <option value="IGD_NNRG_SD"> &nbsp; G2 - Industrielle nichtenergetische G&#252;ter, nur Halbgebrauchsg&#252;ter </option> 
  <option value="IGD_NNRG_ND"> &nbsp; G3 - Industrielle nichtenergetische G&#252;ter, nur Verbrauchsg&#252;ter</option> 
  <option value="SERV_COM"> &nbsp; S1 - Dienstleistungen im Zusammenhang mit Nachrichten&#252;bermittlung</option>
  <option value="SERV_HOUS"> &nbsp; S2 - Dienstleistungen im Zusammenhang mit der Wohnung</option>
  <option value="SERV_TRA"> &nbsp; S3 - Dienstleistungen im Zusammenhang mit Verkehr</option>
  <option value="SERV_REC"> &nbsp; S4 - Dienstleistungen im Zusammenhang mit Freizeit inklusive Reparaturen und K&ouml;rperpflege </option>  
  <option value="SERV_MSC"> &nbsp; S5 - Dienstleistungen - Verschiedenes</option>

  <option value="Group" disabled>[12 COICOP-Hauptgruppen]</option>
  <option value="CP01"> &nbsp; CP01 - Nahrungsmittel und alkoholfreie Getr&#228;nke</option>
  <option value="CP02"> &nbsp; CP02 - Alkoholische Getr&#228;nke, Tabak und Narkotikum</option>
  <option value="CP03"> &nbsp; CP03 - Bekleidung und Schuhe</option>
  <option value="CP04"> &nbsp; CP04 - Wohnung, Wasser, Elektrizit&#228;t, Gas und andere Brennstoffe</option>
  <option value="CP05"> &nbsp; CP05 - Hausrat und laufende Instandhaltung des Hauses</option>
  <option value="CP06"> &nbsp; CP06 - Gesundheit </option>
  <option value="CP07"> &nbsp; CP07 - Verkehr</option>
  <option value="CP08"> &nbsp; CP08 - Nachrichten&#252;bermittlung</option>
  <option value="CP09"> &nbsp; CP09 - Freizeit und Kultur</option>
  <option value="CP10"> &nbsp; CP10 - Bildungswesen</option>
  <option value="CP11"> &nbsp; CP11 - Restaurants und Hotels</option>
  <option value="CP12"> &nbsp; CP12 - Verschiedene Waren und Dienstleistungen</option>

  <option value="Group" disabled>[Other]</option>
  <option value="AP"> &nbsp; Administrierte Preise</option>
</select>

<select class="SubCategory en" id="SubCategorySelection">
  <option value="CP00"> &nbsp; CP00 - All-items HICP </option>
  <option value="Group" disabled>[4 Main Groups]</option>
  <option value="NRG"> &nbsp; E - Energy</option>
  <option value="FOOD"> &nbsp; F - Food</option>
  <option value="IGD_NNRG"> &nbsp; G - Non-energy industrial goods</option>
  <option value="SERV"> &nbsp; S - Services</option>

  <option value="Group" disabled>[12 Subaggregates]</option>
  <option value="ELC_GAS"> &nbsp; E1 - Electricity, gas, heat</option>
  <option value="FUEL"> &nbsp; E2 - Liquid fuels, personal transport lubricants</option>
  <option value="FOOD_NP"> &nbsp; F1 - Unprocessed food including alcohol and Tobacco</option>
  <option value="FOOD_P"> &nbsp; F2 - Processed food</option>
   <option value="IGD_NNRG_D"> &nbsp; G1 - Non-energy industrial goods, durables only</option>
  <option value="IGD_NNRG_SD"> &nbsp; G2 - Non-energy industrial goods, semi-durables only </option>
  <option value="IGD_NNRG_ND"> &nbsp; G3 - Non-energy industrial goods, non-durables only</option>
  <option value="SERV_COM"> &nbsp; S1 - Services related to communication</option>
  <option value="SERV_HOUS"> &nbsp; S2 - Services related to housing </option>
  <option value="SERV_TRA"> &nbsp; S3 - Services related to transport </option>
  <option value="SERV_REC"> &nbsp; S4 - Services related to recreation, including repairs and personal care</option>
  <option value="SERV_MSC"> &nbsp; S5 - Services - miscellaneous </option> 

  <option value="Group" disabled>[12 COICOP main groups]</option> 
  <option value="CP01"> &nbsp; CP01 Food and non-alcoholic beverages </option>
  <option value="CP02"> &nbsp; CP02 Alcoholic beverages, tobacco and narcotics</option>
  <option value="CP03"> &nbsp; CP03 Clothing and footwear</option>
  <option value="CP04"> &nbsp; CP04 Housing, water, electricity, gas and other fuels</option>
  <option value="CP05"> &nbsp; CP05 Furnishings, household equipment and routine household maintenance </option>
  <option value="CP06"> &nbsp; CP06 Health </option>
  <option value="CP07"> &nbsp; CP07 Transport</option>
  <option value="CP08"> &nbsp; CP08 Communications</option>
  <option value="CP09"> &nbsp; CP09 Recreation and culture</option>
  <option value="CP10"> &nbsp; CP10 Education</option>
  <option value="CP11"> &nbsp; CP11 Restaurants and hotels</option>
  <option value="CP12"> &nbsp; CP12 Miscellaneous goods and services</option>

  <option value="Group" disabled>[Other]</option>
  <option value="AP"> &nbsp; Administered prices</option>
</select>

<p class="de"><b>Periode:</b></p>
<p class="en"><b>Time Frame:</b></p>

<div class="inline de">Von &nbsp</div>
<div class="inline en">From &nbsp</div>

<select id="TimeFromSelection">
  <option value="820454400000">1996</option>
  <option value="852076800000">1997</option>
  <option value="883612800000">1998</option>
  <option value="915148800000">1999</option>
  <option value="946684800000">2000</option>
  <option value="978307200000">2001</option>
  <option value="1009843200000">2002</option>
  <option value="1041379200000">2003</option>
  <option value="1072915200000">2004</option>
  <option value="1104537600000">2005</option>
  <option value="1136073600000">2006</option>
  <option value="1167609600000">2007</option>
  <option value="1199145600000">2008</option>
  <option selected value="1230768000000">2009</option>
  <option value="1262304000000">2010</option>
  <option value="1293840000000">2011</option>
  <option value="1325376000000">2012</option>
  <option value="1356998400000">2013</option>
  <option value="1388534400000">2014</option>
</select>

&nbsp - &nbsp

<select id="TimeToSelection">
  <option value="820454400000">1996</option>
  <option value="852076800000">1997</option>
  <option value="883612800000">1998</option>
  <option value="915148800000">1999</option>
  <option value="946684800000">2000</option>
  <option value="978307200000">2001</option>
  <option value="1009843200000">2002</option>
  <option value="1041379200000">2003</option>
  <option value="1072915200000">2004</option>
  <option value="1104537600000">2005</option>
  <option value="1136073600000">2006</option>
  <option value="1167609600000">2007</option>
  <option value="1199145600000">2008</option>
  <option value="1230768000000">2009</option>
  <option value="1262304000000">2010</option>
  <option value="1293840000000">2011</option>
  <option value="1325376000000">2012</option>
  <option value="1356998400000">2013</option>
  <option value="1388534400000">2014</option>
  <option selected value="1551101554000">2015</option>
</select>
</div>

<div class="inlinel">
<p id="countrySelectionLabel"></p>
<form id="Country">
</form>
</div>
<div class="inlinel" id="Diff">
<p id="countrySelectionLabelDiff"></p>
<select id="DiffCountry">
</select>

&nbsp und &nbsp

<select id="DiffCountry2">
</select>
</div>

<div style="clear:both;"></div>
<p id="caption"></p>
<p> The Inflation visualization tool is inspired by <a href="http://nvd3.org/examples/stackedArea.html">Stacked Area chart </a> and <a href="http://nvd3.org/examples/line.html">Simple Line Chart </a> using <a href="https://github.com/novus/nvd3">NVD3 Library </a> and by <a href="http://www.novus.com/">Novus Partners, Inc.</a> 
Released under <a href="https://github.com/novus/nvd3/blob/master/LICENSE.md">Apache License </a>
<script>

/*
$(document).ready(function(){
    $('a#button').click(function(){
        console.log("clicked!");
    });
});*/

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57245203-1', 'auto');
  ga('send', 'pageview');

 $.ajax({
    url: 'https://freegeoip.net/json/',
    type: 'POST',
    dataType: 'jsonp',
    success: function(location) {
       var country_code = location.country_code;
       $.cookie("visitorCountry",country_code) 
    }
  });

// first build up the radios and dropdowns
//Chrome issue, use cookie after reloading

$("#save").on("click", function(){
	saveSvgAsPng(document.getElementById("diagram"), "diagram.png");
}); 


var selectionName = $("#CategorySelection option:selected").val();
if($.cookie("category"))
	selectionName=$.cookie("category");

//$('#CategorySelection option[value="'+$.cookie("category")+'"]').attr("selected","selected");


if(selectionName != 'DIFFREAL' && selectionName != 'CP00'){
	$('.SubCategory').hide();
}

//LANGUAGE DIFFERENTIATION PART
//WHAT TO HIDE AND WHAT TO POP UP
var configFile;

if($('#LanguageSelection').val()==="DE"){
	configFile="data/config/BarchartConfig_de"
	$(".en").hide();	
}
if($('#LanguageSelection').val()==="EN"){
	 configFile="data/config/BarchartConfig_en" 
	$(".de").hide();
}

$('button.btn').click(function(){
	selectionName = $(this).attr("id");
	$.cookie("previous_category", $.cookie("category", selectionName));
	radioName = $('input:radio:checked').val();
	$.cookie("categorySelectionText",$(this).attr("title"));

        $.cookie("diffcountry1", $("#DiffCountry option:selected").val());
        $.cookie("diffcountry2", $("#DiffCountry2 option:selected").val());

        $.cookie("country", radioName);
        $.cookie("category", selectionName);
	location.reload();    
});


$.getJSON(configFile, function(countries) {
	if(typeof $.cookie("category") == 'undefined') //Set defaultly loaded page
		$.cookie("category","NATURAL");
	$("#"+$.cookie("category")+"."+$('#LanguageSelection').val()).addClass('clicked');
        $("#"+$.cookie("previous_category")+"."+$('#LanguageSelection').val()).removeClass('clicked');
	$.cookie("categorySelectionText",$("#"+$.cookie("category")+"."+$('#LanguageSelection').val()).attr("title"))

        if($.cookie("category") == "DIFFREAL" ){
	   	$('#countrySelectionLabel').hide();
		$('#Country').hide();
	}
	else{
		$('#countrySelectionLabel').hide();
	   	$('#Country').show();
	}
	if($.cookie("category") !== "DIFF" ){
	    $('#Diff').hide();
	    if($('#LanguageSelection').val()==="DE"){
	    	$('#countrySelectionLabel').html("<b> Land ausw&#228;hlen: </b>");
	    }
	    if($('#LanguageSelection').val()==="EN"){
		$('#countrySelectionLabel').html("<b> Choose a Country: </b>");
	    }
	    $('#countrySelectionLabelDiff').html("");
	    $("#Country").append("<table>")
	    var counter=1;
	    var appendtext=""
	    $.each(countries.Countries, function( index, fullvalue ) {
		var split = fullvalue.split(';');
		var value=split[0];
		var text = split[1];
		var selectedCountry="EU"
		if($.cookie("visitorCountry"))
                        selectedCountry=$.cookie("visitorCountry")
		//magic number is the divisor which determines the number of rows
		// 39 countries %4  will be 4 columns, for example
	
		if(counter%20==1){ 
                	$("#Country").append(appendtext)
			appendtext=""
			appendtext+="<tr>"
                }
		if($.cookie("country") && $.cookie("country")!='undefined'){
			selectedCountry=$.cookie("country")
		}
		if(value==selectedCountry){
			appendtext+='<td><input type="radio" title="'+text+'" name="Country" checked value="'+value+'">'+value+'</input>'	
		}
		else{
			appendtext+='<td><input type="radio" name="Country" title="'+text+'" value="'+value+'">'+value+'</input>'
		}
		counter=counter+1
	    });
	    $("#Country").append(appendtext)
	}
	else{
	    $('#countrySelectionLabel').html("");
	    if($('#LanguageSelection').val()==="DE"){
            	$('#countrySelectionLabelDiff').html("<b> Zu vergleichende L&#228;nder ausw&#228;hlen: </b>");
	    }
            if($('#LanguageSelection').val()==="EN"){
            	$('#countrySelectionLabelDiff').html("<b> Select Countries to Compare </b>");
	    }  
	    $('#Diff').show();
	    $.each(countries.Countries, function( index, fullvalue ) {
		var split = fullvalue.split(';');
                var value=split[0];
                var text = split[1];
		var diffcountry1='AT'
		if($.cookie("visitorCountry"))
			diffcountry1=$.cookie("visitorCountry")
		var diffcountry2='EA'
		if($.cookie("diffcountry1") && $.cookie("diffcountry1")!='undefined'){
			diffcountry1= $.cookie("diffcountry1")
		}
		if($.cookie("diffcountry2") && $.cookie("diffcountry2")!='undefined'){
                        diffcountry2= $.cookie("diffcountry2")
                }
		if(value===diffcountry1){
			$('<option selected value="'+value+'">'+text+'</option>').appendTo("#DiffCountry");	
	    	}
		else{
			$('<option value="'+value+'">'+text+'</option>').appendTo("#DiffCountry");
		}
		if(value===diffcountry2){
			$('<option selected value="'+value+'">'+text+'</option>').appendTo("#DiffCountry2");
	    	}
		else{
			$('<option value="'+value+'">'+text+'</option>').appendTo("#DiffCountry2");
		}
	    });
	}

	var diffSelected = $("#DiffCountry option:selected").val();
	$('#DiffCountry2 option[value='+diffSelected+']').attr('disabled','disabled');
	
	$.each(countries.Categories, function( index, value ) {
//                $('<option selected value="'+value+'">'+value+'</option>').appendTo("#CategorySelection");
        });

//$('#CategorySelection').prop("disabled", true);
if($.cookie("category")=="CP00"){
	 var selectionText;

	if($('#LanguageSelection').val()==="DE"){
		$('#countryLabel').html("Wie hoch ist die Inflation in "+$('#Country input:radio:checked').attr("title")+"?");
		selectionText=$("#SubCategorySelection.de").find(":selected").text()
	}
	if($('#LanguageSelection').val()==="EN"){
		$('#countryLabel').html("How high is inflation in "+$('#Country input:radio:checked').attr("title")+"?");
		selectionText=$("#SubCategorySelection.en").find(":selected").text()
	}
	var radioName = $('#Country input:radio:checked').val();
 	$('#cateLabel').html(selectionText+" in " + $('#Country input:radio:checked').attr("title"));
	if($('#LanguageSelection').val()==="DE"){
		$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")	
	}
	if($('#LanguageSelection').val()==="EN"){
		$('#caption').html("Source: Eurostat. Last Update: Jan 2015. Inflation subject to HVPI. <br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
	}
}

if($.cookie("category")=="NATURAL" || $.cookie("category")=="CP" || $.cookie("category")=="AP_ALL"){
	if($('#LanguageSelection').val()==="DE"){
		$('#countryLabel').html("Woher kommt die Inflation in "+$('#Country input:radio:checked').attr("title")+"?");
	}
	if($('#LanguageSelection').val()==="EN"){
		$('#countryLabel').html("Where does inflation in "+$('#Country input:radio:checked').attr("title")+" come from?");
	}
	var radioName = $('#Country input:radio:checked').val();
	var selectionText=$.cookie("categorySelectionText");

/*
	if($('#LanguageSelection').val()==="DE"){
		selectionText=$("#CategorySelection.de").find(":selected").text()
	}	
	if($('#LanguageSelection').val()==="EN"){
		selectionText=$("#CategorySelection.en").find(":selected").text()
	}	
*/
	$('#cateLabel').html(selectionText+" in " + $('#Country input:radio:checked').attr("title"));
	if($.cookie("category")=="NATURAL"){
		if($('#LanguageSelection').val()==="DE"){
			$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <p style='font-size:4px'> &nbsp </p> Der Beitrag eines Aggregats zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate des jeweiligen Aggregats mit seiner Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
		}
		if($('#LanguageSelection').val()==="EN"){
			 $('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <p style='font-size:4px'> &nbsp </p> TODO Der Beitrag eines Aggregats zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate des jeweiligen Aggregats mit seiner Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
		}
	}
	if($.cookie("category")=="AP_ALL"){
                if($('#LanguageSelection').val()==="DE"){
                        $('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <p style='font-size:4px'> &nbsp </p> Der Beitrag eines Aggregats zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate des jeweiligen Aggregats mit seiner Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
                }
                if($('#LanguageSelection').val()==="EN"){
                         $('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <p style='font-size:4px'> &nbsp </p> TODO Der Beitrag eines Aggregats zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate des jeweiligen Aggregats mit seiner Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
                }
        }
	else{
		if($('#LanguageSelection').val()==="DE"){
			$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br> <p style='font-size:4px'> &nbsp </p> Der Beitrag einer COICOP Gruppe zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate der jeweiligen COICOP Gruppe mit ihrer Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
		}
		if($('#LanguageSelection').val()==="EN"){
			$('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <br> <p style='font-size:4px'> &nbsp </p> TODO Der Beitrag einer COICOP Gruppe zur Gesamtinflation errechnet sich aus dem Produkt der Inflationsrate der jeweiligen COICOP Gruppe mit ihrer Gewichtung (=Anteil am Gesamtwarenkorb im betrachteten Land).<br><br>This is work in progress. Please send any comments or questions to:  <b>koch(at)ihs.ac.at</b>")
		}
	}
}

if($.cookie("category")=="DIFF"){
	if($('#LanguageSelection').val()==="DE"){
		$('#countryLabel').html("Warum hat "+$("#DiffCountry option:selected").text()+" eine h&#246;here Gesamtinflation als "+$("#DiffCountry2 option:selected").text()+"?");
	
		var radioName = $('#Country input:radio:checked').val();
 		
		$('#cateLabel').html("Beitr&#228;ge zur Inflation im Vergleich von "+$("#DiffCountry option:selected").text()+" mit "+$("#DiffCountry2 option:selected").text());
		$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br> <p style='font-size:4px'> &nbsp </p> Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
	}
	if($('#LanguageSelection').val()==="EN"){
		$('#countryLabel').html("Why does "+$("#DiffCountry option:selected").text()+" have a total higher inflation than "+$("#DiffCountry2 option:selected").text()+"?");
                var radioName = $('#Country input:radio:checked').val();
                $('#cateLabel').html("Contributions to inflation comparing "+$("#DiffCountry option:selected").text()+" with "+$("#DiffCountry2 option:selected").text());
                $('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <br> <p style='font-size:4px'> &nbsp </p> TODO Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
	}
}
   
if($.cookie("category")=="DIFFREAL"){
	if($('#LanguageSelection').val()==="DE"){
        	//$('#countryLabel').html("Wie hoch ist die Inflation in "+$("#DiffCountry option:selected").text()+" im Vergleich mit "+$("#DiffCountry2 option:selected").text()+"?");
        	$('#countryLabel').html("Inflationsvergleich");
		var radioName = $('#Country input:radio:checked').val();
        	$('#cateLabel').html("Inflationsrate (HVPI) Vergleich");
        	$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
	}
	if($('#LanguageSelection').val()==="EN"){
		//$('#countryLabel').html("How high is inflation in "+$("#DiffCountry option:selected").text()+" compared to "+$("#DiffCountry2 option:selected").text()+"?");
                $('#countryLabel').html("Inflation comparison");
		var radioName = $('#Country input:radio:checked').val();
                $('#cateLabel').html("Inflation rate (HVPI) comparison");
                $('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
	}
}

if($.cookie("category") !== "DIFF" && $.cookie("category") !== "DIFFREAL"){
	var radioName = $('#Country input:radio:checked').val();
	mainBody("inputData_"+radioName+"_"+$.cookie("category")+".json");
}

else{
	if($.cookie("category") == "DIFF"){
		var ctr1='AT'
		if($.cookie("visitorCountry"))
                        ctr1=$.cookie("visitorCountry")
		mainBody("diff/inputData_"+ctr1+"vsEA_NATURAL.json");
	}
	if($.cookie("category") == "DIFFREAL"){
		 mainBody("diffreal/inputData_comparisons_"+$('#SubCategorySelection').val()+".json");
	}
}
//var histcatexplong;

//COUNTRY CHANGE LISTENERS

$('input:radio').live("change",function (event){
	radioName = $(this).attr("value");
	$('#CategorySelection').prop("disabled", false);
	var selectionName=$.cookie("category");
	var selectionText;
	if($.cookie("category")=="CP00"){
		if($('#LanguageSelection').val()==="DE"){
			$('#countryLabel').html("Wie hoch ist die Inflation in "+$(this).attr("title")+"?");
                 	selectionName=$("#SubCategorySelection.de").find(":selected").val();
			selectionText=$("#SubCategorySelection.de").find(":selected").text();
		}
		if($('#LanguageSelection').val()==="EN"){
			 $('#countryLabel').html("How high is inflation in "+$(this).attr("title")+"?");
			 selectionName=$("#SubCategorySelection.en").find(":selected").val();
			selectionText=$("#SubCategorySelection.en").find(":selected").text();
		}
	}
        else{
		selectionText=$.cookie("categorySelectionText");
/*
		if($('#LanguageSelection').val()==="DE"){        
			$('#countryLabel').html("Woher kommt die Inflation in "+$(this).attr("title")+"?");
			 selectionText=$("#CategorySelection.de").find(":selected").text();
		}
		if($('#LanguageSelection').val()==="EN"){
			$('#countryLabel').html("Where does inflation in "+$(this).attr("title")+" come from?");
			 selectionText=$("#CategorySelection.en").find(":selected").text();
		}
*/
	}
	/*if($('#CategorySelection').val()=="CP00"){
                 selectionName = $('#SubCategorySelection').val()
                 radioName = $('input:radio:checked').val();
        }*/
	$('#cateLabel').html(selectionText+" in " + $('#Country input:radio:checked').attr("title"));
	mainBody("inputData_"+radioName+"_"+selectionName+".json");
});


//CATEGORY CHANGE LISTENERS
$('#CategorySelection').live("change",function (event){
        selectionName = $(this).attr("value");
	radioName = $('input:radio:checked').val();
	
	$.cookie("diffcountry1", $("#DiffCountry option:selected").val());
	$.cookie("diffcountry2", $("#DiffCountry2 option:selected").val());
	
	$.cookie("country", radioName);
	$.cookie("category", selectionName);	
	location.reload();
});

$('#SubCategorySelection').live("change",function (event){
        selectionName = $(this).attr("value");
	var selectionText;
	if($.cookie("category")=="DIFFREAL"){
	    if($('#LanguageSelection').val()==="DE"){
		selectionText=$("#SubCategorySelection.de").find(":selected").text()+" Vergleich";
                selectionName=$("#SubCategorySelection.de").find(":selected").val();
            }
            if($('#LanguageSelection').val()==="EN"){
                selectionName=$("#SubCategorySelection.en").find(":selected").val();
		selectionText=$("#SubCategorySelection.en").find(":selected").text() + " inflation comparison" ;;
            }
	    $('#cateLabel').html(selectionText);
	}
	else{
	    if($('#LanguageSelection').val()==="DE"){
                selectionText=$("#SubCategorySelection.de").find(":selected").text();
                selectionName=$("#SubCategorySelection.de").find(":selected").val();
            }
            if($('#LanguageSelection').val()==="EN"){
                selectionName=$("#SubCategorySelection.en").find(":selected").val();
                selectionText=$("#SubCategorySelection.en").find(":selected").text();
            }
	$('#cateLabel').html(selectionText+" in " + $('#Country input:radio:checked').attr("title"));
	}
	if($.cookie("category")=="CP00"){
		radioName = $('input:radio:checked').val();
		 mainBody("inputData_"+radioName+"_"+selectionName+".json");
	}
	if($.cookie("category")=="DIFFREAL"){
		var diffCountry1 = $("#DiffCountry option:selected").val();
		var diffCountry2 = $("#DiffCountry2 option:selected").val();	
		mainBody("diffreal/inputData_comparisons_"+selectionName+".json");
	}
});


//COUNTRY CHANGE LISTENERS
$('#DiffCountry').live("change",function (event){
	var diffSelected = $("#DiffCountry option:selected").val();
	var connector="vs"
	var category ="NATURAL"  //if we are comparing contributions, then NATURAL is the only comparison
	var directory="diff/"
	if($.cookie("category") == "DIFFREAL"){
		category=$('#SubCategorySelection').val() 
		directory="diffreal/"
		if($('#LanguageSelection').val()==="DE"){
                	$('#cateLabel').html("Inflationsrate (HVPI) von "+$("#DiffCountry option:selected").text()+" im Vergleich mit "+$("#DiffCountry2 option:selected").text());
                	$('#countryLabel').html("Wie hoch ist die Inflation in "+$("#DiffCountry option:selected").text()+" im Vergleich mit "+$("#DiffCountry2 option:selected").text()+"?");
        	}
		if($('#LanguageSelection').val()==="EN"){
			 $('#cateLabel').html("Inflation rate (HVPI) of"+$("#DiffCountry option:selected").text()+" compared to "+$("#DiffCountry2 option:selected").text());
                	$('#countryLabel').html("How high is inflation in "+$("#DiffCountry option:selected").text()+" compared to "+$("#DiffCountry2 option:selected").text()+"?");
		}
		/*
		$("#DiffCountry2 > option:disabled").each(function() {
                	$('#DiffCountry2 option[value='+this.value+']').removeAttr('disabled',true);
        	});
        	$('#DiffCountry2 option[value='+diffSelected+']').attr('disabled','disabled');
		*/
		 mainBody(directory+"inputData_comparisons_"+category+".json");
	}
	if($.cookie("category") == "DIFF"){
		
		if($('#LanguageSelection').val()==="DE"){
                	$('#countryLabel').html("Warum hat "+$("#DiffCountry option:selected").text()+" eine h&#246;here Gesamtinflation als "+$("#DiffCountry2 option:selected").text()+"?");

                	$('#cateLabel').html("Beitr&#228;ge zur Inflation im Vergleich von "+$("#DiffCountry option:selected").text()+" mit "+$("#DiffCountry2 option:selected").text());
                	$('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br> <p style='font-size:4px'> &nbsp </p> Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
        	}
        	if($('#LanguageSelection').val()==="EN"){
                	$('#countryLabel').html("Why does "+$("#DiffCountry option:selected").text()+" have a total higher inflation than "+$("#DiffCountry2 option:selected").text()+"?");
                	$('#cateLabel').html("Contributions to inflation comparing "+$("#DiffCountry option:selected").text()+" with "+$("#DiffCountry2 option:selected").text());
                	$('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <br> <p style='font-size:4px'> &nbsp </p> TODO Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
        	}	
	$("#DiffCountry2 > option:disabled").each(function() {
                $('#DiffCountry2 option[value='+this.value+']').removeAttr('disabled',true);
        });
	$('#DiffCountry2 option[value='+diffSelected+']').attr('disabled','disabled');	
	mainBody(directory+"inputData_"+$("#DiffCountry option:selected").val()+"vs"+$("#DiffCountry2 option:selected").val()+"_"+category+".json");
}
});

$('#DiffCountry2').live("change",function (event){
       	var diffSelected = $("#DiffCountry2 option:selected").val();
	var connector="vs"
        var category ="NATURAL" //if we are comparing contributions, then NATURAL is the only comparison 
	var directory="diff/"
	if($.cookie("category") == "DIFFREAL"){
                connector="and"
                category=$('#SubCategorySelection').val() //TODO dynamic category
		directory="diffreal/"
	 	if($('#LanguageSelection').val()==="DE"){
                	$('#cateLabel').html("Inflationsrate (HVPI) von "+$("#DiffCountry option:selected").text()+" im Vergleich mit "+$("#DiffCountry2 option:selected").text());
                	$('#countryLabel').html("Wie hoch ist die Inflation in "+$("#DiffCountry option:selected").text()+" im Vergleich mit "+$("#DiffCountry2 option:selected").text()+"?");
        	}
        	if($('#LanguageSelection').val()==="EN"){
                 	$('#cateLabel').html("Inflation rate (HVPI) of"+$("#DiffCountry option:selected").text()+" compared to "+$("#DiffCountry2 option:selected").text());
                	$('#countryLabel').html("How high is inflation in "+$("#DiffCountry option:selected").text()+" compared to "+$("#DiffCountry2 option:selected").text()+"?");
        	}
		mainBody(directory+"inputData_comparisons_"+category+".json");
	}
	if($.cookie("category") == "DIFF"){

                if($('#LanguageSelection').val()==="DE"){
                        $('#countryLabel').html("Warum hat "+$("#DiffCountry option:selected").text()+" eine h&#246;here Gesamtinflation als "+$("#DiffCountry2 option:selected").text()+"?");

                        $('#cateLabel').html("Beitr&#228;ge zur Inflation im Vergleich von "+$("#DiffCountry option:selected").text()+" mit "+$("#DiffCountry2 option:selected").text());
                        $('#caption').html("Quelle: Eurostat. Letze Aktualisierung Jan 2015. Inflation gem&#228;&#223; HVPI. <br> <p style='font-size:4px'> &nbsp </p> Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
                }
                if($('#LanguageSelection').val()==="EN"){
                        $('#countryLabel').html("Why does "+$("#DiffCountry option:selected").text()+" have a total higher inflation than "+$("#DiffCountry2 option:selected").text()+"?");
                        $('#cateLabel').html("Contributions to inflation comparing "+$("#DiffCountry option:selected").text()+" with "+$("#DiffCountry2 option:selected").text());
                        $('#caption').html("Source: Eurostat. Last Update:Jan 2015. Inflation subject to HVPI. <br> <p style='font-size:4px'> &nbsp </p> TODO Das Inflationsdifferential errechnet sich aus der Differenz der Beitr&#228;ge zweier L&#228;nder bezogen auf ein Aggregat. <br><br>This is work in progress. Please send any comments or questions to: <b>koch(at)ihs.ac.at</b>")
                }
        }
	$("#DiffCountry > option:disabled").each(function() {
                $('#DiffCountry option[value='+this.value+']').removeAttr('disabled',true);
        });
        $('#DiffCountry option[value='+diffSelected+']').attr('disabled','disabled'); 
	mainBody(directory+"inputData_"+$("#DiffCountry option:selected").val()+connector+$("#DiffCountry2 option:selected").val()+"_"+category+".json");
});



//CATEGORY CHANGE LISTENER

$('#CategorySelectionDiff').live("change",function (event){
        //selectionName = $("#CategorySelectionDiff option:selected").val()
        //$('#DiffCountry2 option[value='+diffSelected+']').attr('disabled','disabled');
	mainBody("diff/inputData_"+$("#DiffCountry option:selected").val()+"vs"+$("#DiffCountry2 option:selected").val()+"_NATURAL.json");
});

//LANGUAGE CHANGE LISTENER

$('#LanguageSelection').live("change",function (event){
	location.reload();
});

//TIME CHANGE LISTENERS

$('#TimeFromSelection').live("change",function (event){
        var isDiff=""
	var connector="vs"
	var adder=".de"
	var selectionName=$.cookie("category");
	if($('#LanguageSelection').val()==="EN"){
		adder=".en"
	}
	//selectionName = $("#CategorySelection option:selected").val()
	if($.cookie("category")=='DIFF'){
		isDiff="diff/"
		selectionName='NATURAL'
	}
	if($.cookie("category")=='DIFFREAL'){
                isDiff="diffreal/"
		selectionName=$('#SubCategorySelection'+adder).val() //TODO get dynamic selection
       		connector="and" 
	}
	radioName = $('input:radio:checked').val();
	if(typeof radioName=='undefined'){
		radioName = $("#DiffCountry option:selected").val()+connector+$("#DiffCountry2 option:selected").val();
	}
	var selectedYear = $('#TimeFromSelection option:selected').text();
	$("#TimeToSelection > option:disabled").each(function() {
		$('#TimeToSelection option[value='+this.value+']').removeAttr('disabled',true);
        });
	$("#TimeToSelection > option").each(function() {
    		if(this.text <= selectedYear){
			$('#TimeToSelection option[value='+this.value+']').attr('disabled','disabled');
		}
		if(this.text >= selectedYear){
			$('#TimeToSelection option[value='+this.value+']').next('option').attr('selected', 'selected');
		}
	});
        if($.cookie("category")=="CP00"){
                 selectionName = $('#SubCategorySelection'+adder).val()
		 radioName = $('input:radio:checked').val();
        }
	if($.cookie("category")=='DIFFREAL')
		mainBody(isDiff+"inputData_comparisons_"+selectionName+".json");
 	else	
        	mainBody(isDiff+"inputData_"+radioName+"_"+selectionName+".json");
});

$('#TimeToSelection').live("change",function (event){
        var isDiff=""
	var connector="vs"
	 var adder=".de"
        var selectionName = $.cookie("category");
	if($('#LanguageSelection').val()==="EN"){
                adder=".en"
        }
	//selectionName = $("#CategorySelection option:selected").val()
        if($.cookie("category")=='DIFF'){
                isDiff="diff/"
                selectionName='NATURAL'
        }
	if($.cookie("category")=='DIFFREAL'){
                isDiff="diffreal/"
                selectionName=$('#SubCategorySelection'+adder).val() //TODO get dynamic selection
        	var connector="and"
	}
	radioName = $('input:radio:checked').val();
        if(typeof radioName=='undefined'){
                radioName = $("#DiffCountry option:selected").val()+connector+$("#DiffCountry2 option:selected").val();
        }
	if($.cookie("category")=="CP00"){
                 selectionName = $('#SubCategorySelection'+adder).val()
                 radioName = $('input:radio:checked').val();
        }
	if($.cookie("category")=='DIFFREAL')
                mainBody(isDiff+"inputData_comparisons_"+selectionName+".json");
        else
		mainBody(isDiff+"inputData_"+radioName+"_"+selectionName+".json");
});


function mainBody (filename){
$.getJSON("data/"+filename, function(json) {
  var selectionName=$.cookie("category");
  var histcatexplong = json;
  for(var key in histcatexplong) {
    for(var k in histcatexplong[key]) {
	if(k == "values"){
		var low_cut=0
		var high_cut=-1
		var counter=0
		var minValue=$("#TimeFromSelection option:selected").val()
		var maxValue=$("#TimeToSelection option:selected").val()
		for (var z in histcatexplong[key][k]){	
			if(histcatexplong[key][k][low_cut][0]<minValue){
				//histcatexplong[key][k].splice(0,j);
				low_cut=++ low_cut;
			}
			else if(histcatexplong[key][k][counter][0]>maxValue && high_cut==-1){
                                //histcatexplong[key][k].splice(0,j);
				if(counter==0)
					high_cut=0; //this is a country which does not have data 
						   //before the high cut!
				else
					high_cut=counter;
			}
			counter=++ counter;
		}
		if(high_cut!=-1)
			histcatexplong[key][k].splice(high_cut,histcatexplong[key][k].length);
		if (high_cut==0) //this is a country which does not have data before the high cut
				 //so insert a dummy variable - otherwise tooltip dissapears
			 //histcatexplong[key][k][0]
			histcatexplong[key][k][0]= [minValue, "n/a"]
		else	
			histcatexplong[key][k].splice(0,low_cut);
    	}
    }
  }
//var colors = d3.scale.category10();

if(selectionName!="DIFFREAL"){

var colors;
if(selectionName=="NATURAL" || selectionName == 'DIFF'){
	//colors = d3.scale.ordinal().range(["#d62728","#2ca02c", "#ff7f0e","#1f77b4"]);
	colors = d3.scale.ordinal().range(["#FFA500","#32CD32","#1f77b4","#ff3232"]);
}
else if(selectionName=="AP_ALL"){
	//colors = d3.scale.ordinal().range([ "#ffa556", "#ff7f0e", "#41a941", "#238023","#629fca", "#1f77b4", "#15537d", "#e7a1a1", "#d55a5a","#c41414" ,"#890e0e","#4e0808" ]);
	colors = d3.scale.ordinal().range(["#FFD700","#FFA500","#32CD32","#008000","#87CEFA","#4aa6ff","#1E90FF","#FF6347","#ff3232","#ff0000","#cc0000","#7f0000"]);

}
else if (selectionName=="CP"){
	 //colors = d3.scale.ordinal().range(["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695","#9c0eff" ]);	
	 colors = d3.scale.ordinal().range(["#87CEFA","#1E90FF","#008B8B","#32CD32","#008000","#FFD700","#FFA500","#FF8C00","#FF7F50","#e7a1a1","#c41414","#890e0e" ]);	
}
else if (selectionName=="CP00"){
	var subSelection = $('#SubCategorySelection').val();
	if(subSelection=="CP00")
		 colors = d3.scale.ordinal().range(["#1820FF"])
	if(subSelection=="NRG")
                 colors = d3.scale.ordinal().range(["#FFA500"])
	if(subSelection=="FOOD")
                 colors = d3.scale.ordinal().range(["#32CD32"])
	if(subSelection=="IGD_NNRG")
                 colors = d3.scale.ordinal().range(["#1f77b4"])
	if(subSelection=="SERV")
                 colors = d3.scale.ordinal().range(["#ff3232"])
	if(subSelection=="ELC_GAS")
                 colors = d3.scale.ordinal().range(["#FFD700"])
	if(subSelection=="FUEL")
                 colors = d3.scale.ordinal().range(["#FFA500"])
	if(subSelection=="FOOD_P")
                 colors = d3.scale.ordinal().range(["#32CD32"])
	if(subSelection=="FOOD_NP")
                 colors = d3.scale.ordinal().range(["#008000"])
	if(subSelection=="IGD_NNRG_D")
                 colors = d3.scale.ordinal().range(["#87CEFA"])
	if(subSelection=="IGD_NNRG_SD")
                 colors = d3.scale.ordinal().range(["#4aa6ff"])
	if(subSelection=="IGD_NNRG_ND")
                 colors = d3.scale.ordinal().range(["#1E90FF"])
	if(subSelection=="SERV_COM")
                 colors = d3.scale.ordinal().range(["#FF6347"])
	if(subSelection=="SERV_HOUS")
                 colors = d3.scale.ordinal().range(["#ff3232"])
	if(subSelection=="SERV_MSC")
                 colors = d3.scale.ordinal().range(["#7f0000"])
	if(subSelection=="SERV_REC")
                 colors = d3.scale.ordinal().range(["#cc0000"])
	if(subSelection=="SERV_TRA")
                 colors = d3.scale.ordinal().range(["#ff0000"])
	if(subSelection=="CP01")
                 colors = d3.scale.ordinal().range(["#87CEFA"])
	if(subSelection=="CP02")
                 colors = d3.scale.ordinal().range(["#1E90FF"])
	if(subSelection=="CP03")
                 colors = d3.scale.ordinal().range(["#008B8B"])
	if(subSelection=="CP04")
                 colors = d3.scale.ordinal().range(["#32CD32"])
	if(subSelection=="CP05")
                 colors = d3.scale.ordinal().range(["#008000"])
	if(subSelection=="CP06")
                 colors = d3.scale.ordinal().range(["#FFD700"])
	if(subSelection=="CP07")
                 colors = d3.scale.ordinal().range(["#FFA500"])
	if(subSelection=="CP08")
                 colors = d3.scale.ordinal().range(["#FF8C00"])
	if(subSelection=="CP09")
                 colors = d3.scale.ordinal().range(["#FF7F50"])
	if(subSelection=="CP10")
                 colors = d3.scale.ordinal().range(["#e7a1a1"])
	if(subSelection=="CP11")
                 colors = d3.scale.ordinal().range(["#c41414"])
	if(subSelection=="CP12")
                 colors = d3.scale.ordinal().range(["#890e0e"])
	if(subSelection=="AP")
                 colors = d3.scale.ordinal().range(["#FF66B2"])
}
else{
	colors = d3.scale.ordinal().range([ "#2ca02c", "#ff7f0e", "#1f77b4", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf" ]);
}

var keyColor = function(d, i) {return colors(d.key)};
function defaultChartConfig(container, data, useGuideline) {
  if (useGuideline === undefined) useGuideline = true;
  nv.addGraph(function() {
    var chart;
    chart = nv.models.stackedAreaChart(jQuery('#LanguageSelection').val())
                  .useInteractiveGuideline(useGuideline)
                  .x(function(d) { return d[0] })
                  .y(function(d) { return d[1] })
                  .color(keyColor)
                    ;
	//ttvrdic: explicitely state that the x scale data is a time scale	
    chart.xScale(d3.time.scale());

	//ttvrdic: set category in the d3js library. 
	//necessary because of difference in negative values in diff category	
    d3.setCategory(selectionName);

    chart.xAxis
	.ticks(d3.time.months,3) //display data each 3 months
	.tickFormat(function(d) { return d3.time.format('%m/%Y')(new Date(d)) });
	

    chart.yAxis
	.tickFormat(d3.format(',.2f'));

    d3.select('#' + container + ' svg')
          .datum(data)
        .transition().duration(500).call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });
}

defaultChartConfig("chart1", histcatexplong)
//defaultChartConfig("chart3", histcatexplong_singledatapoint);
//defaultChartConfig("chart4", histcatexplong_twodatapoint);
//defaultChartConfig("chart5", histcatexplong_withholes);
//defaultChartConfig("chart6", totalRandom(), false);
//defaultChartConfig("chart7", nPoints(),false);
//defaultChartConfig("chart8", []);
//defaultChartConfig("chart9", histcatexpshort,true);
}
else if(selectionName=="DIFFREAL"){
	nv.addGraph(function() {
 	 var chart = nv.models.lineChart(jQuery('#LanguageSelection').val())
                .margin({left: 100})  //Adjust chart margins to give the x-axis some breathing room.
                .useInteractiveGuideline(true)  //We want nice looking tooltips and a guideline!
                .transitionDuration(350)  //how fast do you want the lines to transition?
                .showLegend(true)       //Show the legend, allowing users to turn on/off line series.
                .showYAxis(true)        //Show the y-axis
                .showXAxis(true)        //Show the x-axis
  ;
  chart.xScale(d3.time.scale());

chart.xAxis
        .ticks(d3.time.months,3) //display data each 3 months
        .tickFormat(function(d) { return d3.time.format('%m/%Y')(new Date(d)) });


  chart.yAxis     //Chart y-axis settings
      .axisLabel('Inflation in percent')
      .tickFormat(d3.format('.2f'));

  /* Done setting the chart up? Time to render it!*/
  var processedData = []; 


  for (var i = 0; i < histcatexplong.length; i++) {
	 var proc = []
        var item = {}
	item ["key"] = histcatexplong[i].key;
	item ["key_en"] = histcatexplong[i].key_en;
	for (var j = 0; j < histcatexplong[i].values.length; j++){
		proc.push({x: histcatexplong[i].values[j][0], y: histcatexplong[i].values[j][1]});
	}
	item["values"]=proc;
	processedData.push(item)
  }
  var myData = processedData;   

  d3.select('#chart1 svg')    //Select the <svg> element you want to render the chart in.   
      .datum(myData)         //Populate the <svg> element with chart data...
      .call(chart);          //Finally, render the chart!

  //Update the chart when window resizes.
  nv.utils.windowResize(function() { chart.update() });
  return chart;
});

}

});
}
});


</script>
